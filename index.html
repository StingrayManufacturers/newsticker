<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Interactive Personalized Ticker</title>
<style>
  :root {
    --bg: #002C73;      /* dark theme page background */
    --fg: #ffffff;      /* base foreground (dark theme) */
    --muted: #c6d4ee;
    --accent: #4cc2ff;
    --danger: #ff6b6b;

    --speed: 35s;       /* ticker animation duration */
    --font-size: 14px;
    --item-gap: 2rem;
    --offset: 0px;      /* keyboard nudge offset */

    /* üîµ Gradient stops for ticker (dark theme) */
    --grad1: #001a4d;
    --grad2: #003a99;
    --grad3: #0057d9;
    --grad4: #0a84ff;
  }

  [data-theme="light"] {
    --bg: #ffffff;      /* keep light theme white */
    --fg: #111111;
    --muted: #5a6b82;
    --accent: #0b6cff;

    /* üîµ Softer gradient for light theme inside ticker */
    --grad1: #eaf3ff;
    --grad2: #d9eaff;
    --grad3: #cfe4ff;
    --grad4: #b9d7ff;
  }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    background: var(--bg);
    color: var(--fg);
  }

  .ticker-wrap {
    border-top: 1px solid rgba(0,0,0,0.12);
    border-bottom: 1px solid rgba(0,0,0,0.12);
    background: transparent;
    padding: .35rem .5rem;
  }

  /* Row holds inline controls (left) + ticker viewport (right) */
  .ticker-row {
    display: flex;
    align-items: center;
    gap: .5rem;
  }

  /* Controls on LEFT ‚Äî icons only */
  .ticker-controls {
    display: inline-flex;
    align-items: center;
    gap: .35rem;
    flex: 0 0 auto;
    z-index: 2; /* above gradient */
  }
  .icon-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.12);
    color: #fff;
    cursor: pointer;
    font-size: 16px;
    line-height: 1;
  }
  .icon-btn:hover { background: rgba(255,255,255,0.18); }
  [data-theme="light"] .icon-btn {
    border-color: rgba(0,0,0,0.18);
    background: rgba(0,0,0,0.06);
    color: #111;
  }
  [data-theme="light"] .icon-btn:hover { background: rgba(0,0,0,0.10); }

  /* Viewport masks the overflowing lane and shows the blue gradient */
  .ticker-viewport {
    position: relative;      /* anchor overlay to match size */
    overflow: hidden;
    flex: 1 1 auto;
    min-width: 0;

    /* üîµ Animated multi-stop blue gradient */
    background: linear-gradient(90deg,
      var(--grad1),
      var(--grad2),
      var(--grad3),
      var(--grad4),
      var(--grad3),
      var(--grad2)
    );
    background-size: 300% 100%;
    animation: tickerGradient 24s ease-in-out infinite;
    border-radius: 8px;
    box-shadow: inset 0 0 18px rgba(0,0,0,0.25);
  }

  @keyframes tickerGradient {
    0%   { background-position: 0% 50%;   }
    50%  { background-position: 100% 50%; }
    100% { background-position: 0% 50%;   }
  }

  .ticker {
    display: flex;
    gap: var(--item-gap);
    width: max-content;
    padding: .25rem .5rem .4rem .5rem;
    animation: tickerScroll var(--speed) linear infinite;
    will-change: transform;
    transform: translateX(calc(var(--offset)));
  }

  /* Paused states: manual pause OR hover-pause OR overlay open */
  .ticker.paused,
  .ticker.hover-paused,
  .ticker.overlay-paused {
    animation-play-state: paused;
  }

  @keyframes tickerScroll {
    from { transform: translateX(calc(0px + var(--offset))); }
    to   { transform: translateX(calc(-50% + var(--offset))); } /* duplicated content ‚Üí seamless */
  }

  .ticker-item {
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: .45rem;
    font-size: var(--font-size);
    font-weight: 800; /* bold */
    /* Dark theme: bold white with black shadow */
    color: #ffffff;
    text-shadow:
      0 1px 0 rgba(0,0,0,0.85),
      0 0 6px rgba(0,0,0,0.55);
  }
  /* Light theme: bold black with white shadow */
  [data-theme="light"] .ticker-item {
    color: #111111;
    text-shadow:
      0 1px 0 rgba(255,255,255,0.95),
      0 0 4px rgba(255,255,255,0.8);
  }

  .ticker a {
    color: inherit; /* inherit bold theme-aware color */
    text-decoration: none;
    border-bottom: 1px dotted rgba(255,255,255,0.35);
  }
  [data-theme="light"] .ticker a {
    border-bottom-color: rgba(0,0,0,0.35);
  }
  .ticker a:hover {
    color: var(--accent);
    border-color: var(--accent);
    text-shadow: none; /* cleaner on hover accent */
  }

  .tag {
    padding: .05rem .4rem;
    border-radius: 6px;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: .4px;
    background: rgba(255,255,255,0.18);
    color: #e9f0ff;
    font-weight: 700;
    text-shadow: none; /* keep tags crisp */
  }
  [data-theme="light"] .tag {
    background: rgba(0,0,0,0.12);
    color: #0b1a2a;
  }
  .tag.News { outline: 1px solid rgba(76,194,255,.35); }
  .tag.Events { outline: 1px solid rgba(77,255,136,.35); }
  .tag.Alerts { outline: 1px solid rgba(255,136,136,.35); }
  .tag.Sports { outline: 1px solid rgba(255,209,102,.35); }
  .tag.Stocks { outline: 1px solid rgba(195,155,255,.35); }

  /* ‚öôÔ∏è Horizontal settings overlay: EXACT ticker size, single line */
  .panel {
    position: absolute;
    inset: 0;                  /* match width & height of .ticker-viewport */
    border-radius: inherit;    /* same rounded corners */
    display: none;
    z-index: 5;                /* above ticker items */
    pointer-events: auto;
    color: #fff;

    background: linear-gradient(180deg,
      rgba(0,0,0,0.60),
      rgba(0,0,0,0.40)
    );
    border: 1px solid rgba(255,255,255,0.18);
    box-shadow: inset 0 0 18px rgba(0,0,0,0.25);
    backdrop-filter: blur(4px);

    /* Horizontal layout */
    padding: .25rem .5rem;
    display: none;
  }
  .panel.open { display: flex; }

  /* Row contents: single line, center aligned */
  .panel-row {
    display: flex;
    align-items: center;
    gap: .5rem;
    width: 100%;
    height: 100%;
  }

  .group {
    display: inline-flex;
    align-items: center;
    gap: .3rem;
    flex: 0 0 auto;
  }

  /* Horizontal scrolling categories to ensure everything fits */
  .chips-scroll {
    display: inline-flex;
    align-items: center;
    gap: .35rem;
    flex: 1 1 auto;              /* take available width */
    overflow-x: auto;
    white-space: nowrap;
    scrollbar-width: thin;
  }
  .chips-scroll::-webkit-scrollbar { height: 6px; }
  .chips-scroll::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.25);
    border-radius: 999px;
  }
  [data-theme="light"] .chips-scroll::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.25);
  }

  .chip {
    border: 1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.10);
    padding: .2rem .5rem;
    border-radius: 999px;
    font-size: 12px;
    cursor: pointer;
    user-select: none;
  }
  [data-theme="light"] .chip {
    border-color: rgba(0,0,0,0.15);
    background: rgba(0,0,0,0.06);
  }
  .chip.active { outline: 2px solid var(--accent); }

  /* Compact controls inside the overlay */
  .icon-btn.sm {
    width: 28px;
    height: 28px;
    font-size: 14px;
    border-radius: 6px;
  }
  .range.sm {
    width: 90px;   /* compact range so it fits */
    height: 6px;
  }

  .sr-only {
    position: absolute !important;
    height: 1px; width: 1px;
    overflow: hidden; clip: rect(1px, 1px, 1px, 1px);
    white-space: nowrap; border: 0; padding: 0; margin: -1px;
  }
</style>
</head>
<body data-theme="dark">
  <div class="ticker-wrap" aria-label="News Ticker">
    <div class="ticker-row">
      <!-- Inline controls (LEFT) ‚Äî icons only -->
      <div class="ticker-controls">
        <!-- Pause/Play button icon only -->
        <button id="pauseBtn" class="icon-btn" aria-pressed="false" aria-label="Pause ticker" title="Pause/Play">
          ‚è∏
        </button>
        <!-- Personalize (settings) button icon only -->
        <button id="gearBtn" class="icon-btn" aria-haspopup="dialog" aria-controls="prefsPanel" aria-expanded="false" aria-label="Personalize" title="Personalize">
          ‚öôÔ∏è
        </button>
      </div>

      <!-- Ticker viewport (RIGHT, with gradient background) -->
      <div class="ticker-viewport" aria-live="polite">
        <div id="tickerLane" class="ticker" role="list" tabindex="0"></div>

        <!-- ‚öôÔ∏è Overlay lives INSIDE the viewport and matches its size (horizontal menu) -->
        <div id="prefsPanel" class="panel" role="dialog" aria-modal="false" aria-labelledby="prefsTitle" hidden>
          <div class="panel-row">
            <!-- Categories (scrollable horizontally) -->
            <div class="group" style="flex:1 1 auto;">
              <span class="sr-only" id="prefsTitle">Personalize Ticker</span>
              <div class="chips-scroll" id="categoryChips" role="group" aria-label="Filter categories"></div>
            </div>

            <!-- Speed (icon + compact slider + icon) -->
            <div class="group" title="Speed">
              <button id="slowerBtn" class="icon-btn sm" aria-label="Slower">‚Äì</button>
              <input id="speedRange" class="range sm" type="range" min="10" max="60" step="5" />
              <button id="fasterBtn" class="icon-btn sm" aria-label="Faster">+</button>
            </div>

            <!-- Font size -->
            <div class="group" title="Font size">
              <span aria-hidden="true" class="icon-btn sm" style="pointer-events:none;opacity:.8;">Aa</span>
              <input id="fontRange" class="range sm" type="range" min="12" max="20" step="1" />
            </div>

            <!-- Theme toggle -->
            <div class="group" title="Theme">
              <button class="icon-btn sm" data-theme="light" aria-label="Light theme">‚òÄÔ∏è</button>
              <button class="icon-btn sm" data-theme="dark" aria-label="Dark theme">üåô</button>
            </div>

            <!-- Reset & Close -->
            <button id="resetBtn" class="icon-btn sm" title="Reset to defaults" aria-label="Reset">‚Ü∫</button>
            <button id="closePanelBtn" class="icon-btn sm" title="Close" aria-label="Close">‚úñ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  /**********************
   * Demo Data Source
   **********************/
  const allItems = [
    { id: 1,  cat: 'News',   text: 'Cape Town water storage tops 95%', url: '#' },
    { id: 2,  cat: 'Events', text: 'Town Hall today at 15:00 (Auditorium A)', url: '#' },
    { id: 3,  cat: 'Alerts', text: 'Phishing alert: MFA prompts from unknown apps', url: '#' },
    { id: 4,  cat: 'Sports', text: 'Boks vs. Wales Saturday ‚Äì lineup announced', url: '#' },
    { id: 5,  cat: 'Stocks', text: 'STING ‚Üë 2.1% after Q3 earnings beat', url: '#' },
    { id: 6,  cat: 'News',   text: 'New Helpdesk portal live ‚Äì faster ticketing', url: '#' },
    { id: 7,  cat: 'Events', text: 'Wellness Day next Friday ‚Äì RSVP open', url: '#' },
    { id: 8,  cat: 'Alerts', text: 'VPN maintenance tonight 22:00‚Äì23:00 SAST', url: '#' },
  ];
  const categories = ['News', 'Events', 'Alerts', 'Sports', 'Stocks'];

  /**********************
   * Preferences (with defaults)
   **********************/
  const PREF_KEY = 'tickerPrefs.v1';
  const defaultPrefs = {
    enabledCategories: new Set(['News','Events','Alerts','Sports','Stocks']),
    speedSeconds: 35,
    fontPx: 14,
    theme: 'dark',
    paused: false,
    offsetPx: 0
  };

  function loadPrefs() {
    try {
      const raw = localStorage.getItem(PREF_KEY);
      if (!raw) return structuredClone(defaultPrefs);
      const obj = JSON.parse(raw);
      return {
        enabledCategories: new Set(obj.enabledCategories || Array.from(defaultPrefs.enabledCategories)),
        speedSeconds: clamp(+obj.speedSeconds || defaultPrefs.speedSeconds, 10, 60),
        fontPx: clamp(+obj.fontPx || defaultPrefs.fontPx, 12, 20),
        theme: ['light','dark'].includes(obj.theme) ? obj.theme : defaultPrefs.theme,
        paused: !!obj.paused,
        offsetPx: +obj.offsetPx || 0
      };
    } catch {
      return structuredClone(defaultPrefs);
    }
  }

  function savePrefs(p) {
    const obj = {
      enabledCategories: Array.from(p.enabledCategories),
      speedSeconds: p.speedSeconds,
      fontPx: p.fontPx,
      theme: p.theme,
      paused: p.paused,
      offsetPx: p.offsetPx
    };
    localStorage.setItem(PREF_KEY, JSON.stringify(obj));
  }

  const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

  let prefs = loadPrefs();

  /**********************
   * Rendering
   **********************/
  const lane = document.getElementById('tickerLane');

  function buildItem(item) {
    const li = document.createElement('div');
    li.className = 'ticker-item';
    li.setAttribute('role', 'listitem');

    const tag = document.createElement('span');
    tag.className = `tag ${item.cat}`;
    tag.textContent = item.cat;

    const link = document.createElement('a');
    link.href = item.url || '#';
    link.textContent = item.text;
    link.target = '_blank';
    link.rel = 'noopener';

    li.appendChild(tag);
    li.appendChild(link);
    return li;
  }

  function getFilteredItems() {
    return allItems.filter(i => prefs.enabledCategories.has(i.cat));
  }

  // Create seamless loop by duplicating items
  function renderLane() {
    lane.innerHTML = '';
    const filtered = getFilteredItems();

    if (filtered.length === 0) {
      lane.appendChild(Object.assign(document.createElement('div'), {
        className: 'ticker-item',
        textContent: 'No items match your filters.'
      }));
      return;
    }

    const fragment = document.createDocumentFragment();
    filtered.forEach(i => fragment.appendChild(buildItem(i)));
    filtered.forEach(i => fragment.appendChild(buildItem(i))); // duplicate

    lane.appendChild(fragment);
    applyPrefsToDOM();
  }

  /**********************
   * Apply Preferences to UI/DOM
   **********************/
  function applyPrefsToDOM() {
    // theme
    document.body.setAttribute('data-theme', prefs.theme);

    // speed
    document.documentElement.style.setProperty('--speed', `${prefs.speedSeconds}s`);

    // font size
    document.documentElement.style.setProperty('--font-size', `${prefs.fontPx}px`);

    // offset (nudge)
    document.documentElement.style.setProperty('--offset', `${prefs.offsetPx}px`);

    // pause state (manual)
    lane.classList.toggle('paused', !!prefs.paused);
    pauseBtn.setAttribute('aria-pressed', prefs.paused ? 'true' : 'false');
    pauseBtn.setAttribute('aria-label', prefs.paused ? 'Play ticker' : 'Pause ticker');
    pauseBtn.title = prefs.paused ? 'Play' : 'Pause';
    pauseBtn.textContent = prefs.paused ? '‚ñ∂Ô∏è' : '‚è∏';
  }

  /**********************
   * Controls & Personalization Overlay
   **********************/
  const pauseBtn = document.getElementById('pauseBtn');
  const gearBtn = document.getElementById('gearBtn');
  const panel = document.getElementById('prefsPanel');
  const speedRange = document.getElementById('speedRange');
  const fontRange = document.getElementById('fontRange');
  const categoryChips = document.getElementById('categoryChips');
  const resetBtn = document.getElementById('resetBtn');
  const slowerBtn = document.getElementById('slowerBtn');
  const fasterBtn = document.getElementById('fasterBtn');
  const closePanelBtn = document.getElementById('closePanelBtn');

  function renderCategoryChips() {
    categoryChips.innerHTML = '';
    categories.forEach(cat => {
      const chip = document.createElement('span');
      chip.className = 'chip' + (prefs.enabledCategories.has(cat) ? ' active' : '');
      chip.textContent = cat;
      chip.setAttribute('role', 'switch');
      chip.setAttribute('aria-checked', prefs.enabledCategories.has(cat) ? 'true' : 'false');
      chip.tabIndex = 0;

      const toggle = () => {
        if (prefs.enabledCategories.has(cat)) {
          prefs.enabledCategories.delete(cat);
        } else {
          prefs.enabledCategories.add(cat);
        }
        chip.classList.toggle('active');
        chip.setAttribute('aria-checked', chip.classList.contains('active') ? 'true' : 'false');
        savePrefs(prefs);
        renderLane();
      };

      chip.addEventListener('click', toggle);
      chip.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          toggle();
        }
      });

      categoryChips.appendChild(chip);
    });
  }

  function hydratePanel() {
    speedRange.value = prefs.speedSeconds;
    fontRange.value = prefs.fontPx;

    // Theme buttons
    panel.querySelectorAll('[data-theme]').forEach(btn => {
      // visual active state
      btn.style.outline = (btn.dataset.theme === prefs.theme) ? `2px solid var(--accent)` : 'none';
      btn.onclick = () => {
        prefs.theme = btn.dataset.theme;
        panel.querySelectorAll('[data-theme]').forEach(n => n.style.outline = 'none');
        btn.style.outline = `2px solid var(--accent)`;
        savePrefs(prefs);
        applyPrefsToDOM();
      };
    });
  }

  // Open/close overlay ‚Äî overlay matches ticker size, pauses while open
  function openPanel() {
    panel.classList.add('open');
    panel.hidden = false;
    gearBtn.setAttribute('aria-expanded', 'true');
    hydratePanel();
    lane.classList.add('overlay-paused'); // pause ticker while overlay open
  }
  function closePanel() {
    panel.classList.remove('open');
    panel.hidden = true;
    gearBtn.setAttribute('aria-expanded', 'false');
    lane.classList.remove('overlay-paused'); // resume (unless manually paused)
  }

  gearBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // prevent outside-click handler
    panel.classList.contains('open') ? closePanel() : openPanel();
  });
  closePanelBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    closePanel();
  });

  // Prevent clicks inside the overlay from closing it
  panel.addEventListener('click', (e) => {
    e.stopPropagation();
  });

  // Close when clicking outside the overlay
  document.addEventListener('click', (e) => {
    const path = e.composedPath ? e.composedPath() : [];
    const clickedInsidePanel = path.includes(panel) || (e.target.closest && e.target.closest('#prefsPanel'));
    const clickedGear = (e.target === gearBtn) || (e.target.closest && e.target.closest('#gearBtn'));
    if (!clickedInsidePanel && !clickedGear && panel.classList.contains('open')) {
      closePanel();
    }
  });

  // Close overlay on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && panel.classList.contains('open')) {
      closePanel();
    }
  });

  // Pause/Play (icon only)
  pauseBtn.addEventListener('click', () => {
    prefs.paused = !prefs.paused;
    savePrefs(prefs);
    applyPrefsToDOM();
  });

  // Inputs & small buttons
  speedRange.addEventListener('input', () => {
    prefs.speedSeconds = Number(speedRange.value);
    savePrefs(prefs);
    applyPrefsToDOM();
  });
  slowerBtn.addEventListener('click', () => {
    prefs.speedSeconds = clamp(prefs.speedSeconds + 5, 10, 60); // slower
    savePrefs(prefs);
    applyPrefsToDOM();
    speedRange.value = prefs.speedSeconds;
  });
  fasterBtn.addEventListener('click', () => {
    prefs.speedSeconds = clamp(prefs.speedSeconds - 5, 10, 60); // faster
    savePrefs(prefs);
    applyPrefsToDOM();
    speedRange.value = prefs.speedSeconds;
  });

  fontRange.addEventListener('input', () => {
    prefs.fontPx = Number(fontRange.value);
    savePrefs(prefs);
    applyPrefsToDOM();
  });

  // Reset
  resetBtn.addEventListener('click', () => {
    prefs = structuredClone(defaultPrefs);
    savePrefs(prefs);
    renderCategoryChips();
    renderLane();
    hydratePanel();
  });

  // Boot
  renderCategoryChips();
  renderLane();

  /**********************
   * Hover pause (does not alter saved pause state)
   **********************/
  function onHoverIn() {
    lane.classList.add('hover-paused');
  }
  function onHoverOut() {
    lane.classList.remove('hover-paused');
  }
  lane.addEventListener('mouseenter', onHoverIn, true);
  lane.addEventListener('mouseleave', onHoverOut, true);

  /**********************
   * Keyboard Shortcuts (no visual hints)
   *  Space  ‚Üí pause/play
   *  ‚Üê / ‚Üí  ‚Üí nudge scroll
   *  + / ‚Äì  ‚Üí speed
   *  [ / ]  ‚Üí font size
   *  1..5   ‚Üí toggle categories
   **********************/
  const NUDGE = 40;
  function handleKey(e) {
    const tag = (e.target.tagName || '').toLowerCase();
    if (tag === 'input' || tag === 'textarea') return;

    if (e.code === 'Space') {
      e.preventDefault();
      prefs.paused = !prefs.paused;
      savePrefs(prefs);
      applyPrefsToDOM();
      return;
    }

    if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
      e.preventDefault();
      const delta = (e.key === 'ArrowLeft') ? NUDGE : -NUDGE;
      prefs.offsetPx = (prefs.offsetPx || 0) + delta;
      prefs.offsetPx = Math.max(Math.min(prefs.offsetPx, 100000), -100000);
      savePrefs(prefs);
      applyPrefsToDOM();
      return;
    }

    if (e.key === '+' || e.key === '=') {
      e.preventDefault();
      prefs.speedSeconds = clamp(prefs.speedSeconds - 5, 10, 60); // faster
      savePrefs(prefs);
      applyPrefsToDOM();
      speedRange.value = prefs.speedSeconds;
      return;
    }
    if (e.key === '-' || e.key === '_') {
      e.preventDefault();
      prefs.speedSeconds = clamp(prefs.speedSeconds + 5, 10, 60); // slower
      savePrefs(prefs);
      applyPrefsToDOM();
      speedRange.value = prefs.speedSeconds;
      return;
    }

    if (e.key === '[') {
      e.preventDefault();
      prefs.fontPx = clamp(prefs.fontPx - 1, 12, 20);
      savePrefs(prefs);
      applyPrefsToDOM();
      fontRange.value = prefs.fontPx;
      return;
    }
    if (e.key === ']') {
      e.preventDefault();
      prefs.fontPx = clamp(prefs.fontPx + 1, 12, 20);
      savePrefs(prefs);
      applyPrefsToDOM();
      fontRange.value = prefs.fontPx;
      return;
    }

    if (/^[1-5]$/.test(e.key)) {
      const idx = parseInt(e.key, 10) - 1;
      const cat = categories[idx];
      if (cat) {
        e.preventDefault();
        if (prefs.enabledCategories.has(cat)) prefs.enabledCategories.delete(cat);
        else prefs.enabledCategories.add(cat);
        savePrefs(prefs);
        renderCategoryChips();
        renderLane();
      }
    }
  }
  document.addEventListener('keydown', handleKey);
</script>
</body>
</html>
